CC=gcc
FLAGS=-Wall
output=gerer_sf_v1
deps=bloc.o inode.o
RM=rm -f
HREF=fourni/V1/bloc.h fourni/V1/inode.h
SANITIZES=-fsanitize=address,undefined

# Variable des sanitizers pass√©s dans la commande
SANITIZERS=
ifeq ($(strip $(S)),)
	ifneq (,$(findstring S,$(MAKEFLAGS)))
		# Si on a -S dans la ligne de commande on rajoute les sanitizers
		SANITIZERS=$(SANITIZES)
	endif
endif

# Message d'avertissement des sanitizers
ECHO_MSG=@echo -e "\033[0;32mCompilation normale\033[0m"

ifneq ($(strip $(SANITIZERS)),) # Modification
	ECHO_MSG=@echo -e "\033[0;31mAjout des sanitizers\033[0m"
endif

$(output): $(output).o $(deps)
	$(ECHO_MSG)
	$(CC) $(FLAGS) $(SANITIZERS) $(output).o $(deps) -o $(output).exe

$(output).o: $(output).c $(HREF)
	$(CC) $(FLAGS) $(SANITIZERS) -c $(output).c

bloc.o: fourni/V1/bloc.c fourni/V1/bloc.h
	$(CC) $(FLAGS) $(SANITIZERS) -c fourni/V1/bloc.c
inode.o: fourni/V1/inode.c fourni/V1/inode.h
	$(CC) $(FLAGS) $(SANITIZERS) -c fourni/V1/inode.c

clean:
	$(RM) *.o *.exe
